{% extends 'base.html' %} 
{% block title %}Detalhes da Sala: {{ room.name }}{% endblock %} 
{% block content %}
<div class="min-h-screen p-8">
  <div class="max-w-4xl mx-auto">
    <div
      class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4"
    >
      <h1 class="text-4xl font-bold text-rpg-gold font-medieval">
        {{ room.name }}
      </h1>
      <div class="flex space-x-3">
        {% if room.master == user %}
        <a
          href="{% url 'room_templates:room-update-template' pk=room.pk %}"
          class="px-4 py-2 bg-yellow-600 text-gray-900 rounded-lg hover:bg-yellow-700 transition-colors"
        >
          <i class="fas fa-edit mr-2"></i>Editar
        </a>
        <a
          href="{% url 'room_templates:room-delete-template' pk=room.pk %}"
          class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
        >
          <i class="fas fa-trash-alt mr-2"></i>Excluir
        </a>
        {% endif %}
        <a
          href="{% url 'room_templates:room-list-template' %}"
          class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
        >
          <i class="fas fa-arrow-left mr-2"></i>Voltar para a Lista
        </a>
      </div>
    </div>

    <div
      class="bg-gray-800 p-8 rounded-xl shadow-2xl border-2 border-rpg-gold space-y-6"
    >
      <div class="pt-4 border-t border-gray-700">
        <h3 class="text-xl text-rpg-gold font-semibold mb-3">
          Gerenciamento de Personagens
        </h3>

        {% comment %} Link de Criação de Personagem {% endcomment %} 
        {% if user in room.players.all or room.master == user %}
        <a
          href="{% url 'room_templates:character-create-in-room' room_pk=room.pk %}"
          class="inline-block px-4 py-2 bg-rpg-green text-white rounded-lg hover:bg-green-700 transition-colors"
        >
          <i class="fas fa-plus-circle mr-2"></i>
          {% if room.master == user %}Criar NPC/Monstro{% else %}Criar Meu Personagem{% endif %}
        </a>
        {% endif %} 
        </div> 
      
      {% if room.master == user %}
      <div class="mt-4 pt-4 border-t border-rpg-gold">
        <h3 class="text-2xl text-rpg-gold font-medieval font-semibold mb-4">
          Adicionar Personagens à Sala
        </h3>

        <div class="bg-gray-900 p-6 rounded-xl space-y-4">
          <h4 class="text-xl text-white font-semibold mb-3">
            Personagens Disponíveis (PJs e seus NPCs/Monstros)
          </h4>

          {% if available_characters %}
          <form
            method="POST"
            action="{% url 'room_templates:add-character-to-room' room_pk=room.pk character_pk=0 %}"
            id="add-character-form"
            data-base-url="{% url 'room_templates:add-character-to-room' room_pk=room.pk character_pk=0 %}"
          >
            </form>
          {% endif %}
        </div>
      </div>
      {% endif %}
      
      <div class="pt-4 border-t border-gray-700">
        <h3 class="text-xl text-rpg-gold font-semibold mb-3">
          Jogadores ({{ room.players.count }})
        </h3>

        {% if room.master == user %}
        <div class="flex flex-wrap gap-3">
          {% for player in room.players.all %}
          <div
            class="bg-rpg-green text-gray-900 font-semibold px-3 py-1 rounded-full flex items-center"
          >
            {{ player.username }} {% if player != user %}
            <a
              href="{% url 'room_templates:toggle-player-in-room' room_pk=room.pk user_pk=player.pk %}"
              class="ml-2 text-red-800 hover:text-red-600 transition-colors"
              title="Remover {{ player.username }}"
            >
              <i class="fas fa-times-circle text-lg"></i>
            </a>
            {% else %}
            <span class="ml-2 text-rpg-red">(Você)</span>
            {% endif %}
          </div>
          {% empty %}
          {% endfor %}
        </div>

        {% else %}
        {% endif %}
      </div>

      {% if room.master == user %}
      <div class="mt-4 pt-4 border-t border-rpg-gold">
        <div class="bg-gray-900 p-6 rounded-xl space-y-4">
          <div
            class="flex flex-wrap gap-2 max-h-60 overflow-y-auto p-2 border border-gray-700 rounded-lg"
          >
            {% for possible_player in all_users %}
            <a
              href="{% url 'room_templates:toggle-player-in-room' room_pk=room.pk user_pk=possible_player.pk %}"
              class="bg-blue-600 text-white px-3 py-1 text-sm rounded-full hover:bg-blue-700 transition-colors flex items-center"
              title="Adicionar {{ possible_player.username }}"
            >
              <i class="fas fa-user-plus mr-1"></i> {{ possible_player.username
              }}
            </a>
            {% empty %}
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}
      </div>
  </div>
</div>
{% endblock %}